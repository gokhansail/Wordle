using System;
using System.Drawing;
using System.Windows.Forms;

public partial class CustomForm : Form
{
    private Timer fadeTimer = new Timer();
    private bool closing = false;
    private Panel titleBar = new Panel();
    private Button closeButton = new Button();

    public CustomForm()
    {
        InitializeComponent();
        this.FormBorderStyle = FormBorderStyle.None;
        this.Opacity = 0; // Başlangıçta formun saydamlığını 0 yap

        // Özel başlık çubuğu
        titleBar.BackColor = Color.Black;
        titleBar.Dock = DockStyle.Top;
        titleBar.Height = 30;
        this.Controls.Add(titleBar);

        // Kapatma butonu
        closeButton.Text = "X";
        closeButton.ForeColor = Color.White;
        closeButton.BackColor = Color.Red;
        closeButton.Height = titleBar.Height;
        closeButton.Width = 30;
        closeButton.Dock = DockStyle.Right;
        closeButton.Click += (s, e) => { this.Close(); };
        titleBar.Controls.Add(closeButton);

        // Animasyon zamanlayıcısı
        fadeTimer.Interval = 10; // Hızlı bir geçiş için milisaniye cinsinden zaman aralığı
        fadeTimer.Tick += new EventHandler(FadeIn);
        fadeTimer.Start();
    }

    private void FadeIn(object sender, EventArgs e)
    {
        if (this.Opacity < 1 && !closing)
        {
            this.Opacity += 0.05; // Her tikte opaklığı artır
        }
        else if (closing)
        {
            if (this.Opacity > 0)
            {
                this.Opacity -= 0.05; // Her tikte opaklığı azalt
            }
            else
            {
                fadeTimer.Stop();
                this.Close(); // Opaklık 0 olduğunda formu kapat
            }
        }
        else
        {
            fadeTimer.Stop(); // Tam opaklıkta zamanlayıcıyı durdur
        }
    }

    protected override void OnFormClosing(FormClosingEventArgs e)
    {
        if (!closing)
        {
            e.Cancel = true; // Formun doğrudan kapanmasını engelle
            closing = true;
            fadeTimer.Start(); // Kapanış animasyonunu başlat
        }
        base.OnFormClosing(e);
    }

    protected override void OnMouseDown(MouseEventArgs e)
    {
        base.OnMouseDown(e);
        if (e.Button == MouseButtons.Left && titleBar.ClientRectangle.Contains(e.Location))
        {
            titleBar.Capture = false;
            Message m = Message.Create(this.Handle, 0xA1, new IntPtr(2), IntPtr.Zero);
            this.DefWndProc(ref m);
        }
    }
}
