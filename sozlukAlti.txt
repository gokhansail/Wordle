using System;
using System.Drawing;
using System.Drawing.Drawing2D;
using System.Windows.Forms;

public partial class CustomForm : Form
{
    private Timer fadeTimer = new Timer();
    private bool closing = false;
    private ToolStrip toolStrip = new ToolStrip();
    private ToolStripButton closeButton = new ToolStripButton();
    private ToolStripButton minimizeButton = new ToolStripButton();

    public CustomForm()
    {
        InitializeComponent();
        this.FormBorderStyle = FormBorderStyle.None;
        this.Opacity = 0; // Başlangıçta formun saydamlığını 0 yap

        // ToolStrip ayarları
        toolStrip.Dock = DockStyle.Top;
        toolStrip.AutoSize = false;
        toolStrip.Height = 30;
        toolStrip.BackColor = Color.LightGray;
        toolStrip.RenderMode = ToolStripRenderMode.Professional;
        toolStrip.GripStyle = ToolStripGripStyle.Hidden;
        this.Controls.Add(toolStrip);

        // Minimize butonu
        minimizeButton.Image = SystemIcons.Application.ToBitmap(); // Sistem ikonu kullanıldı
        minimizeButton.DisplayStyle = ToolStripItemDisplayStyle.Image;
        minimizeButton.Click += (s, e) => { this.WindowState = FormWindowState.Minimized; };
        toolStrip.Items.Add(minimizeButton);

        // Kapatma butonu
        closeButton.Image = SystemIcons.Error.ToBitmap(); // Sistem ikonu kullanıldı
        closeButton.DisplayStyle = ToolStripItemDisplayStyle.Image;
        closeButton.Click += (s, e) => { this.Close(); };
        toolStrip.Items.Add(closeButton);

        // Animasyon zamanlayıcısı
        fadeTimer.Interval = 10;
        fadeTimer.Tick += new EventHandler(FadeIn);
        fadeTimer.Start();
    }

    private void FadeIn(object sender, EventArgs e)
    {
        if (this.Opacity < 1 && !closing)
        {
            this.Opacity += 0.05;
        }
        else if (closing)
        {
            if (this.Opacity > 0)
            {
                this.Opacity -= 0.05;
            }
            else
            {
                fadeTimer.Stop();
                this.Close();
            }
        }
        else
        {
            fadeTimer.Stop();
        }
    }

    protected override void OnFormClosing(FormClosingEventArgs e)
    {
        if (!closing)
        {
            e.Cancel = true;
            closing = true;
            fadeTimer.Start();
        }
        base.OnFormClosing(e);
    }

    protected override void OnPaintBackground(PaintEventArgs e)
    {
        base.OnPaintBackground(e);
        // Arka plana gradient efekt ekleme
        LinearGradientBrush lgb = new LinearGradientBrush(this.ClientRectangle, Color.White, Color.Gray, LinearGradientMode.Vertical);
        e.Graphics.FillRectangle(lgb, this.ClientRectangle);
    }

    protected override void OnMouseDown(MouseEventArgs e)
    {
        base.OnMouseDown(e);
        if (e.Button == MouseButtons.Left && toolStrip.Bounds.Contains(e.Location))
        {
            toolStrip.Capture = false;
            Message m = Message.Create(this.Handle, 0xA1, new IntPtr(2), IntPtr.Zero);
            this.DefWndProc(ref m);
        }
    }
}
